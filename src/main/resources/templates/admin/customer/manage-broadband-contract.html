<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="../static/fragments/layout :: site-head">
    <title>Customer Management</title>
</head>
<body>
<header th:replace="../static/fragments/layout :: header"/>
<script th:if="${broadbandContract.id}" th:inline="javascript">
    /*<![CDATA[*/
    showBroadbandContractNotes(/*[[${broadbandContract.id}]]*/);
    showTpsContactsList(/*[[${customerSite.customer.id}]]*/);
    /*]]>*/
</script>
<div class="container-fluid">
    <h1 th:text="${customerSite.fullSiteNameAndAddress}">Site</h1>
    <h2>Manage Broadband Contract</h2>
    <div class="row">
        <div class="col-md-6">
            <div class="panel panel-primary">
                <div class="panel-heading">Customer Details</div>
                <div class="panel-body">
                    <table class="table table-condensed">
                        <thead>
                        <tr>
                            <th>Customer Reference</th>
                            <th>Company Registration No</th>
                            <th>Business Name</th>
                            <th>Site Name</th>
                            <th>Site Post Code</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td><a th:href="@{/admin/customer/view/{id}/(id=${customerSite.customer.id})}" th:inline="text">[[${customerSite.customer.customerReference}]]</a>
                            </td>
                            <td th:text="${customerSite.registrationNo}">Registration Number</td>
                            <td><a th:href="@{/admin/customer/view/{id}/(id=${customerSite.customer.id})}" th:inline="text">[[${customerSite.customer.businessName}]]</a>
                            </td>
                            <td th:text="${customerSite.siteName}">Customer Site Name</td>
                            <td th:text="${customerSite.sitePostcodeOut} + ' ' +${customerSite.sitePostcodeIn}">Customer
                                Site Post Code Out and In
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-md-6" id="contactDetails">
            <!--				TPS Contact Details go here -->
        </div>
    </div>

    <div class="col-md-6">
        <div class="well well-sm">
            <form class="form-horizontal" id="form" method="post" th:action="@{/broadbandContract}" th:object="${broadbandContract}">
                <input th:field="*{id}" type="hidden"/>
                <input id="customerSite" name="customerSite" th:value="${customerSite.id}" type="hidden"/>
                <div class="form-group" sec:authorize="!hasAnyAuthority('BROKER','EXTERNAL_BROKER')">
                    <div class="col-md-12">
                        <div class="panel panel-warning">
                            <div class="panel-heading">Checklist</div>
                            <div class="panel-body">
                                <label class="checkbox-inline"><input th:field="*{contractSentToCustomer}" type="checkbox"/>Contract Sent To Customer</label>
                                <label class="checkbox-inline"><input th:field="*{contractReceived}" type="checkbox"/>Contract Received</label>
                                <label class="checkbox-inline"><input th:field="*{welcomePackSentToCustomer}" type="checkbox"/>Welcome Pack Sent To Customer</label>
                                <label class="checkbox-inline"><input th:field="*{previousSupplyTerminated}" type="checkbox"/>Previous Supply Terminated</label>
                                <label class="checkbox-inline"><input th:field="*{currentSupplyTerminated}" type="checkbox"/>Current Supply Terminated</label>
                                <label class="checkbox-inline"><input th:field="*{courtesyCall}" type="checkbox"/>Courtesy Call Made</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-4" for="phoneNumber">Phone Number</label>
                    <div class="col-md-8">
                        <input class="form-control input-sm"
                               placeholder="phone number"
                               th:field="*{phoneNumber}"
                               type="text"/>
                    </div>
                </div>
                <div class="form-group" sec:authorize="!hasAnyAuthority('BROKER','EXTERNAL_BROKER')">
                    <label class="control-label col-md-4" for="brokerId">Broker</label>
                    <div class="col-md-8">
                        <select class="form-control input-sm" id="broker" name="broker">
                            <option th:each="b:${brokers}" th:text="${b.businessName}" th:value="${b.id}"></option>
                        </select>
                    </div>
                </div>
                <div class="form-group" sec:authorize="hasAnyAuthority('BROKER','EXTERNAL_BROKER')">
                    <label class="control-label col-md-4" for="brokerId">Broker</label>
                    <a data-placement="right"
                       data-toggle="tooltip"
                       href="#"
                       title="As a broker you are have been selected by default!">
                <span
                        class="glyphicon glyphicon-info-sign"></span></a>
                    <div class="col-md-8">
                        <select class="form-control input-sm" id="broker" name="broker">
                            <option th:each="b:${brokers}" th:if="${b.id == #authentication.principal.broker?.id}" th:text="${b.businessName}" th:value="${b.id}"></option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-4">Monthly Charge</label>
                    <div class="col-md-8">
                        <input class="form-control input-sm" th:field="*{monthlyCharge}" type="text"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-4">Current Supplier</label>
                    <div class="col-md-8">
                        <select class="form-control input-sm" id="supplier" name="supplier" th:field="*{supplier}">
                            <option th:each="s:${suppliers}" th:text="${s.businessName}" th:value="${s.id}"></option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-4" for="startDate">Start Date</label>
                    <div class="col-md-8">
                        <input class="form-control input-sm" id="altStartDate" name="altStartDate" placeholder="Start Date" readonly="readonly"
                               th:value="*{startDate != null} ? *{#dates.format(startDate, 'dd/MM/yyyy')}" type="text"/>
                        <input id="startDate" name="startDate" th:value="*{startDate}" type="hidden"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-4" for="contractMonthlyDuration">Contract Term</label>
                    <div class="col-md-8">
                        <select class="form-control input-sm" th:field="*{contractMonthlyDuration}">
                            <option th:each="i : ${#numbers.sequence( 0, 60)}" th:value="${i}" th:text="${i}+' Months'">1</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-4" for="endDate">End Date</label>
                    <div class="col-md-8">
                        <input class="form-control input-sm" id="altEndDate" name="altEndDate" placeholder="End Date" readonly="readonly"
                               th:value="*{endDate != null} ? *{#dates.format(endDate, 'dd/MM/yyyy')}" type="text"/>
                        <input id="endDate" name="endDate" th:value="*{endDate}" type="hidden"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-4">Termination Fee</label>
                    <div class="col-md-8">
                        <input class="form-control input-sm" th:field="*{terminationFee}" type="text"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-4">keep Existing L/line number</label>
                    <div class="col-sm-4">
                        <select class="form-control input-sm" th:field="*{keepExistingLineNumber}">
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-4">No of Lines/Users</label>
                    <div class="col-md-8">
                        <input class="form-control input-sm"
                               placeholder="No of Lines/Users"
                               th:field="*{noOflines}"
                               type="text"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-4">Call Recording</label>
                    <div class="col-sm-4">
                        <select class="form-control input-sm" th:field="*{callRecording}">
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-4">Auto Attendant</label>
                    <div class="col-sm-4">
                        <select class="form-control input-sm" th:field="*{autoAttendant}">
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-4">Additional Questions</label>
                    <div class="col-md-8">
                        <input class="form-control input-sm"
                               placeholder="additional questions"
                               th:field="*{additionalQuestions}"
                               type="text"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-4" for="logType">Log Type</label>
                    <div class="col-md-8">
                        <select class="form-control input-sm" required="required" th:field="*{logType}">
                            <option th:each="logType : ${T(mycrm.configuration.LogType).values()}"
                                    th:text="${logType}" th:value="${logType}"></option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-4">Contract Renewal</label>
                    <div class="col-md-8">
                        <input class="form-control input-sm"
                               placeholder="Contract Renewal"
                               th:field="*{contractRenewal}"
                               type="text"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-4">Do Not Renew</label>
                    <div class="col-md-2">
                        <input th:field="*{doNotRenew}" type="checkbox"/>
                    </div>
                    <div class="col-md-6">
                        <div class="col-md-4">
                            <label class="control-label">Reason</label>
                        </div>
                        <div class="col-md-8">
                            <select class="form-control input-sm" id="contractReason" name="contractReason">
                                <option value="">Not Applicable</option>
                                <option th:each="c:${contractReasons}" th:text="${c.description}" th:value="${c.id}"></option>
                            </select>
                        </div>
                    </div>

                </div>
                <div class="form-group">
                    <label class="control-label col-md-4">Lost Renewal</label>
                    <div class="col-md-2">
                        <input th:field="*{lostRenewal}" type="checkbox"/>
                    </div>
                    <div class="col-md-6">
                        <div class="col-md-4">
                            <label class="control-label">Reason</label>
                        </div>
                        <div class="col-md-8">
                            <select class="form-control input-sm" id="lostRenewalReason" name="lostRenewalReason">
                                <option value="">Not Applicable</option>
                                <option th:each="c:${lostRenewalReasons}" th:text="${c.description}" th:value="${c.id}"></option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-4" for="callbackDateTime">Call Back Date and Time</label>
                    <div class="col-md-6">
                        <input autocomplete="off" class="form-control input-sm" placeholder="Call Back Date" th:field="*{callbackDateTime}" type="text"/>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-primary btn-sm"
                                data-target="#callback-diary"
                                data-toggle="modal"
                                type="button">Diary
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-offset-3 col-sm-10">
                        <a class="btn btn-danger btn-sm" data-target="#myModal" data-toggle="modal" id="delButton" sec:authorize="hasAuthority('SUPERADMIN')">Delete</a>
                        <button class="btn btn-success btn-sm" type="submit">Submit</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="col-md-6" th:if="${broadbandContract.id}">
        <div class="panel panel-info">
            <div class="panel-heading">Contract Notes</div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-12">
                        <a class="btn btn-default pull-right" data-target="#newNoteModal" data-toggle="modal">Create new
                            note</a>
                    </div>
                </div>
                <div id="broadband-contract-notes-div"></div>
            </div>
        </div>
        <div class="modal fade" id="newNoteModal" role="dialog">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button class="close" data-dismiss="modal" type="button">&times;</button>
                        <h4 class="modal-title">New Note</h4>
                    </div>
                    <div class="modal-body">
                        <form class="form-horizontal" id="broadbandNote" name="broadbandNote">
                            <input id="customer" name="customer"
                                   th:value="${broadbandContract.customerSite.customer.id}" type="hidden"/>
                            <input id="elecCustomerContract" name="elecCustomerContract" type="hidden" value=""/>
                            <input id="gasCustomerContract" name="gasCustomerContract" type="hidden" value=""/>
                            <input id="utilityContract" name="utilityContract" type="hidden" value=""/>
                            <input id="broadbandContract" name="broadbandContract"
                                   th:value="${broadbandContract.id}" type="hidden"/>
                            <div class="form-group">
                                <div class="col-md-6">
                                    <input class="form-control" id="subject" name="subject" placeholder="Subject"
                                           required="required" type="text"/>
                                </div>
                                <div class="col-md-6">
                                    <select class="form-control input-sm" id="taggedUser" name="taggedUser">
                                        <option value="">Tagged User</option>
                                        <option th:each="u:${users}" th:text="${u.firstName}+' '+${u.lastName}"
                                                th:value="${u.id}"></option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <textarea class="form-control" cols="100" id="note" name="note"
                                              placeholder="Enter note here" required="required" rows="5"></textarea>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-3">
                                    <label>Completed: <input id="completed" name="completed" type="checkbox"/></label>
                                </div>
                                <div class="col-md-3">
                                    <input class="form-control input-sm" id="altDueByDate" name="altDueByDate"
                                           placeholder="Due by Date" readonly="readonly"
                                           th:value="*{dueByDate != null} ? *{#dates.format(dueByDate, 'dd/MM/yyyy')}"
                                           type="text"/>
                                    <input id="dueByDate" name="dueByDate" th:value="*{dueByDate}" type="hidden"/>
                                </div>
                                <div class="col-md-3">
                                    <select class="form-control input-sm" id="priority" name="priority">
                                        <option value="LOW">LOW</option>
                                        <option value="MEDIUM">MEDIUM</option>
                                        <option value="HIGH">HIGH</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label>Quick Win: <input id="quickWin" name="quickWin" type="checkbox"/></label>
                                </div>
                                <div class="col-md-3">
                                    <select class="form-control input-sm" id="relatedTo" name="relatedTo">
                                        <option value="">Related to</option>
                                        <option th:each="relatedTo : ${T(mycrm.configuration.RelatedTo).values()}"
                                                th:text="${relatedTo}" th:value="${relatedTo}"></option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-4">
                                    <a class="btn btn-success"
                                       th:href="'javascript:saveBroadbandContractNote(\''+ ${broadbandContract.id} +'\');'">
                                        <span class="glyphicon glyphicon-save"></span> Add Note
                                    </a>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-default" data-dismiss="modal" type="button">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
</body>
<div th:replace="../static/fragments/layout :: callbackDateTime"/>
</html>
